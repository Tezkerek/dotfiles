#!/bin/zsh

local localfile="$HOME/passwords.kdbx"
local remotefile="dropbox:passwords.kdbx"
local tmpfile="/tmp/remote_passwords.kdbx"

function fetch_file {
    rclone copyto $remotefile $tmpfile --progress
}

case $1 in
    fetch)
        fetch_file
        ;;
    pull)
        fetch_file
        keepassxc-cli merge $localfile $tmpfile --same-credentials
        ;;
    push)
        rclone copyto $localfile $remotefile --progress
        ;;
    diff)
        keepass-diff $localfile $tmpfile
        ;;
esac
